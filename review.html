<!DOCTYPE html>
<html lang="en"
<head>
    <meta charset="UTF-8">
    <title>Review Applications</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <header>
        <h1>School Database Management System</h1>
        <nav>
            <span>Role: Administrator</span>
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('student_portal') }}">Student</a>
            <a href="{{ url_for('instructor_portal') }}">Instructor</a>
            <a href="{{ url_for('admin_portal') }}">Administrator</a>
        </nav>
    </header>

    <main>

        {# Flash message (e.g., 'Application Accpeted') #}
        {% with message =  get_flashed_messages() %}
            {% if messages %}
                <ul class="flash">
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <h2>Review Applications</h2>
        <p>
            This page is used by administrators to <strong>review, accept, or refuse</strong>
            applications submitted to the system (e.g., student admissions, staff hiring, etc.).
        </p>
        {# Optional search / filter bar #}
            <form method="get" class="search-form">
            <label for="query">Search Applications:</label>
            <input type="text" id="query" name="q" value="{{ request.args.get('q', '') }}">
            <button type="submit" class="button">Search</button>
        </form>
        <div class="card">
            <h3>Pending Applications</h3>
            <p>Applications waiting for decision. Use the buttons to accept or refuse.</p>   
        </div>
        <div class="card">
            <h3>Status Legend</h3>
            <p>
                <strong>Pending</strong> - requires review<br>
                <strong>Accepted</strong> - approved into the system<br>
                <strong>Refused</strong> - application denied
            </p>
        </div>
    <h3>Applications List</h3>

    {% if applications and applications|length > 0 %}
        <table>
            <thead>
                <tr>
                    <th>Application ID</th>
                    <th>Applicant Name</th>
                    <th>Type</th>
                    <th>Submitted On</th>
                    <th>Current Status</th>
                    <th>Decision</th>
                </tr>
            </thead>
            <tbody>
                {% for app in applications %}
                <tr>
                    <td>{{ app.id }}</td>
                    <td>{{ app.applicant_name }}</td>
                    <td>{{ app.application_type }}</td>
                    <td>{{ app.submitted_at.strftime('%Y-%m-%d') if app.submitted_at else 'N/A' }}</td>
                    <td>{{ app.status }}</td>
                    <td>
                        {# Accept Button #}
                        <form method="post" action="{{ url_for('review_applications') }}" style="display:inline;">
                            <input type="hidden" name="application_id" value="{{ app.id }}">
                            <input type="hidden" name="decision" value="accept">
                            <button type="submit" class="button">Accept</button>
                        </form>

                        {# Refuse Button #}
                        <form method="post" action="{{ url_for('review_applications') }}" style="display:inline; margin-left:4px;">
                            <input type="hidden" name="application_id" value="{{ app.id }}">
                            <input type="hidden" name="decision" value="refuse">
                            <button type="submit" class="button">Refuse</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% else %}
            <p><em>No Applications Found.</em></p>
        {% endif %}

        {# Optional pagination controls #}
        {% if page_count and page_count > 1 %}
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url_for('review_applications', page=page-1, q=request.args.get('q')) }}">Previous</a>
            {% endif %}

            <span>Page {{ page }} of {{ page_count }}</span>

            {% if page < page_count %}
                <a href="{{ url_for('review_applications', page=page+1, q=request.args.get('q')) }}">Next</a>
            {% endif %}
        </div>
        {% endif %}

    </main>

    <footer>
        Review Applications - School Database Management System Project 
    </footer>
</body>
</html>